<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Categories</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="d-flex" style="background-color: black;">

  <!-- Sidebar -->
  <%- include("partials/superadminsidebar") %>

  <!-- Main Content -->
  <div class="main-content flex-grow-1 p-4">
   <h5 class="mb-3 text-white">Category Management</h5>

 <!-- Top controls -->
<div class="d-flex justify-content-between align-items-center mb-3 gap-2 flex-wrap">

  <!-- Search -->
  <form method="GET" action="/admin/courses/categories" class="d-flex gap-2">
    <input type="text" name="search" class="form-control search-box w-auto"
      placeholder="Search categories..."
      value="<%= search || '' %>"
      onkeypress="if(event.key === 'Enter'){ this.form.submit(); }">

    <!-- preserve filters -->
    <% if (statusFilter && statusFilter !== 'all') { %>
      <input type="hidden" name="status" value="<%= statusFilter %>">
    <% } %>
    <% if (sortBy && sortBy !== 'default') { %>
      <input type="hidden" name="sortBy" value="<%= sortBy %>">
    <% } %>
  </form>

  <!-- Status filter -->
  <form method="GET" action="/admin/courses/categories" class="d-inline-block">
    <select name="status" class="form-select custom-select w-auto rounded-pill" onchange="this.form.submit()">
      <option value="all" <%= statusFilter==='all' ? 'selected' : '' %>>All Status</option>
      <option value="active" <%= statusFilter==='active' ? 'selected' : '' %>>Active</option>
      <option value="inactive" <%= statusFilter==='inactive' ? 'selected' : '' %>>Inactive</option>
    </select>

    <% if (search) { %>
      <input type="hidden" name="search" value="<%= search %>">
    <% } %>
    <% if (sortBy && sortBy !== 'default') { %>
      <input type="hidden" name="sortBy" value="<%= sortBy %>">
    <% } %>
  </form>

  <!-- Sorting filter -->
<form method="GET" action="/admin/courses/categories" class="d-inline-block">
  <select name="sortBy" class="form-select custom-select w-auto rounded-pill" onchange="this.form.submit()">
    <option value="default" <%= sortBy==='default' ? 'selected' : '' %>>Sort By</option>
    <option value="courses_asc" <%= sortBy==='courses_asc' ? 'selected' : '' %>>Courses: Low → High</option>
    <option value="courses_desc" <%= sortBy==='courses_desc' ? 'selected' : '' %>>Courses: High → Low</option>
    <option value="authors_asc" <%= sortBy==='authors_asc' ? 'selected' : '' %>>Contributors: Low → High</option>
    <option value="authors_desc" <%= sortBy==='authors_desc' ? 'selected' : '' %>>Contributors: High → Low</option>
    <option value="students_asc" <%= sortBy==='students_asc' ? 'selected' : '' %>>Enrollment: Low → High</option>
    <option value="students_desc" <%= sortBy==='students_desc' ? 'selected' : '' %>>Enrollment: High → Low</option>
  </select>

  <% if (search) { %>
    <input type="hidden" name="search" value="<%= search %>">
  <% } %>
  <% if (statusFilter && statusFilter !== 'all') { %>
    <input type="hidden" name="status" value="<%= statusFilter %>">
  <% } %>
</form>

  <!-- Add New -->
  <a href="/admin/courses/addcategory" class="btn cousre-btn rounded-pill">
    <i class="bi bi-plus-circle"></i> Add New
  </a>
</div>
      <div class="table">
        <table class="table table-dark align-middle table-borderless">
          <thead>
            <tr>
              <th scope="col">Category</th>

                            <th scope="col">Status</th>
              <th scope="col">Courses</th>
              <th scope="col">Contributors</th>
              <th scope="col">Enrollment</th>
             

              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (categories&& categories.length> 0) { %>
              <% categories.forEach(categories=> { %>
                <tr>
                     <td>
                     <%= categories.name %>
                  </td>
                
          
                  <td>
                    <% if (categories.status==='active' ) { %>
                      <span class="text-success fw-bold">Active</span>
                      <% } else if (categories.status==='inActive' ) { %>
                          <span class="text-warning fw-bold">Inactive</span>
                          <% } else { %>
                            <span class="text-primary fw-bold">
                              <%= categories.status %>
                            </span>
                            <% } %>
                  </td>
                  <td class="fw-bold">
                    <%= categories.courseCount %>
                  </td>
                  
 <td class="fw-bold">
                    <%= categories.authors %>
                  </td>
 <td class="fw-bold">
                    <%= categories.students %>
                  </td>
<td>
                    <a href="/admin/courses/categories/<%= categories._id %>/edit" class="btn btn-sm btn-outline-success me-2">
                      <i class="bi bi-pencil-square"></i> Edit
                    </a>



<form action="/admin/courses/categories/<%= categories._id %>/delete" method="POST" class="delete-form" style="display:inline;">
  <button type="submit" class="btn btn-sm btn-outline-danger">
    <i class="bi bi-trash"></i> Delete
  </button>

</form>
          
                    
                  </td>
                </tr>
                <% }) %>
                  <% } else { %>
                    <tr>
                      <td colspan="12" class="text-center">No results found</td>
                    </tr>
                    <% } %>
          </tbody>
        </table>
      </div>





    <!-- Pagination -->
<nav class="d-flex justify-content-center mt-3">
  <ul class="pagination pagination-dark pagination-sm flex-wrap">
    
    <!-- Previous -->
    <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
      <a class="page-link rounded-circle"
         href="/admin/courses/categories?page=<%= currentPage-1 %>&status=<%= statusFilter %>&sortBy=<%= sortBy %>&search=<%= search %>">
         ‹
      </a>
    </li>

    <!-- Page Numbers -->
    <% for(let i = 1; i <= totalPages; i++) { %>
      <li class="page-item <%= currentPage === i ? 'active' : '' %>">
        <a class="page-link rounded-circle"
           href="/admin/courses/categories?page=<%= i %>&status=<%= statusFilter %>&sortBy=<%= sortBy %>&search=<%= search %>">
           <%= i %>
        </a>
      </li>
    <% } %>

    <!-- Next -->
    <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
      <a class="page-link rounded-circle"
         href="/admin/courses/categories?page=<%= currentPage+1 %>&status=<%= statusFilter %>&sortBy=<%= sortBy %>&search=<%= search %>">
         ›
      </a>
    </li>

  </ul>
</nav>

      
          <%- include("partials/flashalerts") %>


</body>


<script>
  document.querySelectorAll(".delete-form").forEach(form => {
    form.addEventListener("submit", function (e) {
      e.preventDefault(); // stop immediate form submission

      Swal.fire({
        title: "Are you sure?",
        text: "This category will be permanently removed!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#d33",
        cancelButtonColor: "#6c757d",
        confirmButtonText: "Yes, delete it!",
      }).then((result) => {
        if (result.isConfirmed) {
          form.submit(); // submit only if confirmed
        }
      });
    });
  });
</script>
</html>
